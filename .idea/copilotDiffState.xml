<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/java/com/codewithmosh/store/services/JwtService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/codewithmosh/store/services/JwtService.java" />
              <option name="originalContent" value="package com.codewithmosh.store.services;&#10;&#10;import com.codewithmosh.store.dtos.UserDto;&#10;import com.fasterxml.jackson.core.JsonProcessingException;&#10;import com.fasterxml.jackson.databind.ObjectMapper;&#10;import io.jsonwebtoken.Claims;&#10;import io.jsonwebtoken.JwtException;&#10;import io.jsonwebtoken.Jwts;&#10;import io.jsonwebtoken.security.Keys;&#10;import org.springframework.beans.factory.annotation.Value;&#10;import org.springframework.stereotype.Service;&#10;&#10;import java.util.Date;&#10;&#10;@Service&#10;public class JwtService {&#10;    final long tokenExpiration = 86400; // token well expires in 24 hours&#10;    @Value(&quot;${spring.jwt.secret}&quot;)&#10;    private String secret;&#10;&#10;    public String generateToken(UserDto userDto){&#10;        return Jwts.builder()&#10;            .subject(Long.toString(userDto.getId()))&#10;            .claim(&quot;email&quot; , userDto.getEmail())&#10;            .claim(&quot;name&quot; , userDto.getName())&#10;            .issuedAt(new Date())&#10;            .expiration(new Date(System.currentTimeMillis() + 1000 * tokenExpiration))&#10;            .signWith(Keys.hmacShaKeyFor(secret.getBytes()))&#10;            .compact();&#10;&#10;    }&#10;&#10;    public boolean validateToken(String token){&#10;        try{&#10;            var claims = getPayload(token);&#10;            return claims.getExpiration().after(new Date());&#10;        } catch (JwtException e) {&#10;            throw new JwtException(e.getMessage());&#10;        }&#10;    }&#10;    public Long getId(String token) {&#10;        var claims = getPayload(token);&#10;        String subject = claims.getSubject();&#10;        // defensive checks: subject may be null, empty or the literal string &quot;null&quot;&#10;        if(subject == null || subject.isEmpty() || &quot;null&quot;.equalsIgnoreCase(subject.trim())){&#10;            throw new JwtException(&quot;Invalid token subject&quot;);&#10;        }&#10;&#10;        try{&#10;            return Long.parseLong(subject.trim());&#10;        } catch (NumberFormatException ex){&#10;            throw new JwtException(&quot;Invalid token subject: not a valid id&quot;, ex);&#10;        }&#10;    }&#10;&#10;    private Claims getPayload(String token) {&#10;        return Jwts.parser()&#10;                .verifyWith(Keys.hmacShaKeyFor(secret.getBytes()))&#10;                .build()&#10;                .parseSignedClaims(token)&#10;                .getPayload();&#10;    }&#10;&#10;}&#10;" />
              <option name="updatedContent" value="package com.codewithmosh.store.services;&#10;&#10;import com.codewithmosh.store.dtos.UserDto;&#10;import com.fasterxml.jackson.core.JsonProcessingException;&#10;import com.fasterxml.jackson.databind.ObjectMapper;&#10;import io.jsonwebtoken.Claims;&#10;import io.jsonwebtoken.JwtException;&#10;import io.jsonwebtoken.Jwts;&#10;import io.jsonwebtoken.security.Keys;&#10;import org.springframework.beans.factory.annotation.Value;&#10;import org.springframework.stereotype.Service;&#10;&#10;import java.util.Date;&#10;&#10;@Service&#10;public class JwtService {&#10;    final long tokenExpiration = 86400; // token well expires in 24 hours&#10;    @Value(&quot;${spring.jwt.secret}&quot;)&#10;    private String secret;&#10;&#10;    public String generateToken(UserDto userDto){&#10;        return Jwts.builder()&#10;            .subject(Long.toString(userDto.getId()))&#10;            .claim(&quot;email&quot; , userDto.getEmail())&#10;            .claim(&quot;name&quot; , userDto.getName())&#10;            .issuedAt(new Date())&#10;            .expiration(new Date(System.currentTimeMillis() + 1000 * tokenExpiration))&#10;            .signWith(Keys.hmacShaKeyFor(secret.getBytes()))&#10;            .compact();&#10;&#10;    }&#10;&#10;    public boolean validateToken(String token){&#10;        try{&#10;            var claims = getPayload(token);&#10;            return claims.getExpiration().after(new Date());&#10;        } catch (JwtException e) {&#10;            throw new JwtException(e.getMessage());&#10;        }&#10;    }&#10;    public Long getId(String token) {&#10;        var claims = getPayload(token);&#10;        String subject = claims.getSubject();&#10;        // defensive checks: subject may be null, empty or the literal string &quot;null&quot;&#10;        if(subject == null || subject.isEmpty() || &quot;null&quot;.equalsIgnoreCase(subject.trim())){&#10;            throw new JwtException(&quot;Invalid token subject&quot;);&#10;        }&#10;&#10;        try{&#10;            return Long.parseLong(subject.trim());&#10;        } catch (NumberFormatException ex){&#10;            throw new JwtException(&quot;Invalid token subject: not a valid id&quot;, ex);&#10;        }&#10;    }&#10;&#10;    private Claims getPayload(String token) {&#10;        return Jwts.parser()&#10;                .verifyWith(Keys.hmacShaKeyFor(secret.getBytes()))&#10;                .build()&#10;                .parseSignedClaims(token)&#10;                .getPayload();&#10;    }&#10;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>